# SPDX-FileCopyrightText: Copyright (c) 2025, NVIDIA CORPORATION & AFFILIATES. All rights reserved.
# SPDX-License-Identifier: Apache-2.0
#
# Licensed under the Apache License, Version 2.0 (the "License");
# you may not use this file except in compliance with the License.
# You may obtain a copy of the License at
#
# http://www.apache.org/licenses/LICENSE-2.0
#
# Unless required by applicable law or agreed to in writing, software
# distributed under the License is distributed on an "AS IS" BASIS,
# WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
# See the License for the specific language governing permissions and
# limitations under the License.


general:
  telemetry:
    tracing:
      weave:
        _type: weave
        project: "nat-ata-optimize"

functions:
  hardware_check:
    _type: hardware_check
    llm_name: tool_reasoning_llm
    offline_mode: true
  host_performance_check:
    _type: host_performance_check
    llm_name: tool_reasoning_llm
    offline_mode: true
  monitoring_process_check:
    _type: monitoring_process_check
    llm_name: tool_reasoning_llm
    offline_mode: true
  network_connectivity_check:
    _type: network_connectivity_check
    llm_name: tool_reasoning_llm
    offline_mode: true
  telemetry_metrics_host_heartbeat_check:
    _type: telemetry_metrics_host_heartbeat_check
    llm_name: tool_reasoning_llm
    offline_mode: true
    metrics_url: http://your-monitoring-server:9090 # Replace with your monitoring system URL if running in live mode
  telemetry_metrics_host_performance_check:
    _type: telemetry_metrics_host_performance_check
    llm_name: tool_reasoning_llm
    offline_mode: true
    metrics_url: http://your-monitoring-server:9090 # Replace with your monitoring system URL if running in live mode
  telemetry_metrics_analysis_agent:
    _type: telemetry_metrics_analysis_agent
    tool_names:
      - telemetry_metrics_host_heartbeat_check
      - telemetry_metrics_host_performance_check
    llm_name: telemetry_metrics_analysis_agent_llm
    optimizable_params:
      - prompt
  maintenance_check:
    _type: maintenance_check
    llm_name: maintenance_check_llm
    static_data_path: examples/advanced_agents/alert_triage_agent/data/maintenance_static_dataset.csv
  categorizer:
    _type: categorizer
    llm_name: categorizer_llm
  prompt_init:
    _type: prompt_init
    optimizer_llm: optimizer_llm
    system_objective: The alert triage agent autonomously investigates infrastructure monitoring alerts, performs root cause analysis, and generates structured diagnostic reports by dynamically selecting and orchestrating diagnostic tools including IPMI hardware checks, network connectivity tests, host performance monitoring, process status verification, and telemetry analysis, then correlating multi-source data through LLM-powered reasoning to classify issues into predefined categories (hardware, software, network, false positive, or requiring investigation), helping security analysts reduce manual triage workload, accelerate incident response times, and maintain consistent investigation quality through standardized evidence collection and automated documentation of findings and recommended remediation actions.
  prompt_recombination:
    _type: prompt_recombiner
    optimizer_llm: optimizer_llm
    system_objective: The alert triage agent autonomously investigates infrastructure monitoring alerts, performs root cause analysis, and generates structured diagnostic reports by dynamically selecting and orchestrating diagnostic tools including IPMI hardware checks, network connectivity tests, host performance monitoring, process status verification, and telemetry analysis, then correlating multi-source data through LLM-powered reasoning to classify issues into predefined categories (hardware, software, network, false positive, or requiring investigation), helping security analysts reduce manual triage workload, accelerate incident response times, and maintain consistent investigation quality through standardized evidence collection and automated documentation of findings and recommended remediation actions.

workflow:
  _type: alert_triage_agent
  tool_names:
    - hardware_check
    - host_performance_check
    - monitoring_process_check
    - network_connectivity_check
    - telemetry_metrics_analysis_agent
  llm_name: ata_agent_llm
  offline_mode: true
  # The below paths are only used if offline_mode is true
  offline_data_path: examples/advanced_agents/alert_triage_agent/data/offline_data.csv
  benign_fallback_data_path: examples/advanced_agents/alert_triage_agent/data/benign_fallback_offline_data.json
  optimizable_params:
    - agent_prompt

llms:
  ata_agent_llm:
    _type: nim
    model_name: meta/llama-3.3-70b-instruct
    temperature: 0.2
    max_tokens: 2048
    optimizable_params:
      - temperature
      - top_p
      - max_tokens

  tool_reasoning_llm:
    _type: nim
    model_name: meta/llama-3.3-70b-instruct
    temperature: 0.2
    top_p: 0.7
    max_tokens: 2048
    optimizable_params:
      - temperature
      - top_p
      - max_tokens

  telemetry_metrics_analysis_agent_llm:
    _type: nim
    model_name: meta/llama-3.3-70b-instruct
    temperature: 0
    max_tokens: 2048
    optimizable_params:
      - temperature
      - top_p
      - max_tokens

  maintenance_check_llm:
    _type: nim
    model_name: meta/llama-3.3-70b-instruct
    temperature: 0
    max_tokens: 2048

  categorizer_llm:
    _type: nim
    model_name: meta/llama-3.3-70b-instruct
    temperature: 0
    max_tokens: 2048
    optimizable_params:
      - temperature
      - top_p
      - max_tokens

  nim_rag_eval_llm:
    _type: nim
    model_name: meta/llama-3.3-70b-instruct
    max_tokens: 8

  optimizer_llm:
    _type: nim
    model_name: meta/llama-3.3-70b-instruct
    temperature: 0.5
    max_tokens: 2048


eval:
  general:
    output_dir: .tmp/examples/advanced_agents/alert_triage_agent/original/
    workflow_alias: alert_triage_agent_optimizer
    dataset:
      _type: json
      file_path: examples/advanced_agents/alert_triage_agent/data/offline_data.json

  evaluators:
    rag_accuracy:
      _type: ragas
      metric: AnswerAccuracy
      llm_name: nim_rag_eval_llm
    classification_accuracy:
      _type: classification_accuracy

optimizer:
  output_path: .tmp/examples/advanced_agents/alert_triage_agent/optimizer/
  reps_per_param_set: 2
  eval_metrics:
    rag_accuracy:
      evaluator_name: rag_accuracy
      direction: maximize
    classification_accuracy:
      evaluator_name: classification_accuracy
      direction: maximize
    
  numeric:
    enabled: true
    n_trials: 3

  prompt:
    enabled: true
    prompt_population_init_function: prompt_init
    prompt_recombination_function: prompt_recombination
    ga_generations: 3
    ga_population_size: 3
    ga_diversity_lambda: 0.3
    ga_parallel_evaluations: 1